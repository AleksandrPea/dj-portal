{"version":3,"sources":["v2.nvd3-timeline/timeline-chart-decoration.js"],"names":[],"mappings":"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","file":"v2.nvd3-timeline/timeline-chart-decoration.js","sourcesContent":["import angular from 'angular';\r\nimport 'widgets/v2.nvd3-widget/nvd3-widget';\r\nimport \"widgets/v2.nvd3-timeline/adapter\";\r\nimport \"wizard-directives\";\r\nimport 'ng-ace';\r\n\r\nvar m = angular.module(\"app.widgets.v2.steps.timeline-chart-decoration\",[\r\n\t'app.widgets.v2.nvd3-widget',\r\n    \"app.widgets.v2.timeline-chart-adapter\", \r\n    \"wizard-directives\", \"app.dps\", \"ng.ace\"]);\r\n\r\nm.factory(\"TimelineChartDecoration\",[\r\n\t\"$http\",\r\n\t\"$q\", \r\n\t\"$dps\",\r\n\t\"dialog\",\r\n\t\"appUrls\",\r\n\t\"parentHolder\",\r\n\t\"TimelineChartAdapter\", \r\n\t\"pageWidgets\",\r\n\t\"i18n\",\r\n\t\"$lookup\",\r\n\t\"EventEmitter\",\r\n\t\"dpsEditor\",\r\n\tfunction(\r\n\t\t$http, \r\n\t\t$q, \r\n\t\t$dps,\r\n\t\tdialog,\r\n\t\tappUrls,\r\n\t\tparentHolder, \r\n\t\tTimelineChartAdapter,\r\n\t\tpageWidgets,\r\n\t\ti18n,\r\n\t\t$lookup,\r\n\t\tEventEmitter,\r\n\t\tdpsEditor ){\r\n\t\t\r\n\t\tlet chartAdapter = TimelineChartAdapter;\r\n\r\n\t\treturn {\r\n\t\t\tid: \"TimelineChartChartDecoration\",\r\n\r\n\t\t\ttitle : \"Chart Decoration\",\r\n\t\t\t\r\n\t\t\tdescription : \"Setup chart decoration options\",\r\n\t        \r\n\t    \thtml : \"./widgets/v2.nvd3-timeline/timeline-chart-decoration.html\",\r\n\r\n\t  //   \tformatlist : [\t\"%Y-%m-%d\", \"%m/%d/%Y\", \"%H:%M\",\"%H:%M %p\", \"%B %d\", \"%d %b\", \"%d-%b-%y\", \"%S s\", \"%M m\", \"%H h\", \"%a\", \"%A\", \"%d d\", \"%b\", \"%m/%Y\",\r\n\t\t\t// \t\t\t\t\"%b %Y\", \"%B\", \"%c\", \"%d\", \"%e\", \"%H\", \"%I\", \"%j\", \r\n\t\t\t// \t\t\t\t\"%m\", \"%M\", \"%L\", \"%p\", \"%S\", \"%U\", \"%w\", \"%W\", \"%x\", \"%X\", \"%y\", \"%Z\" \r\n\t\t\t// ],\r\n\r\n\t    \tonStartWizard: function(wizard){\r\n\t    \t\tthis.wizard = wizard;\r\n\t    \t\tthis.conf = {\r\n\t    \t\t\tdecoration : wizard.conf.decoration,\r\n\t    \t\t\tdataID : wizard.conf.dataID,\r\n\t    \t\t\tscript : wizard.conf.script,\r\n\t    \t\t\tserieDataId: wizard.conf.dataID,\r\n\t    \t\t\toptionsUrl : \"./widgets/v2.nvd3-timeline/options.json\",\r\n\t    \t\t\tdataUrl : \"/api/data/process/\"\r\n\t    \t\t}\r\n\t    \t\t// console.log(\"Start step\", this)\r\n\t    \t\t// var d = new Date()\r\n\t    \t\t// this.formatlist.forEach(function(item){\r\n\t    \t\t// \tconsole.log(d3.locale(i18n.localeDef()).timeFormat(item)(d))\r\n\t    \t\t// })\t\r\n\t    \t},\r\n\r\n\t    \tonFinishWizard:  function(wizard){\r\n\t    \t\twizard.conf.decoration = this.conf.decoration;\r\n\t    \t\twizard.conf.dataID  = this.conf.dataID;\r\n\t    \t\twizard.conf.script  = this.conf.script;\r\n\t    \t\twizard.conf.serieDataId  = this.conf.serieDataId;\r\n\t    \t\tthis.settings = {options:angular.copy(this.options), data:[]};\r\n\t    \t\tthis.conf = {};\r\n\t    \t\tthis.data = undefined;\r\n\t    \t\t// console.log(\"Finish step\", this)\r\n\t    \t},\r\n\r\n\t    \tonCancelWizard: function(wizard){\r\n\t\t\t\tthis.settings = {options:angular.copy(this.options), data:[]};\r\n\t\t\t\tthis.conf = {};\r\n\t    \t},\r\n\r\n\t    \treversePalette: function(){\r\n\t\t\t\tif ( this.conf.decoration.color ){\r\n\t\t\t\t\tthis.conf.decoration.color = this.conf.decoration.color.reverse(); \r\n\t\t\t\t}\t\r\n\t\t\t},\r\n\r\n\t    \t// _prepare : function(data){\r\n      //         var result = data.map((item) => {return item})\r\n      //         result.forEach((item) => {\r\n      //           if(item.end == null) delete item.end;\r\n      //           if(item.note == null) delete item.note;\r\n                \r\n      //           if(item.income == null) {\r\n      //             delete item.income\r\n      //           }else{\r\n      //             item.income.forEach((p) => {\r\n      //               if(p.marker == null) delete p.marker\r\n      //             })\r\n      //           } \r\n\r\n      //           if(item.expenditure == null) {\r\n      //             delete item.expenditure\r\n      //           }else{\r\n      //             item.expenditure.forEach((p) => {\r\n      //               if(p.marker == null) delete p.marker\r\n      //             })\r\n      //           } \r\n\r\n      //           if(item.causes == null) {\r\n      //             delete item.causes\r\n      //           }else{\r\n      //             item.causes.forEach((p) => {\r\n      //               if(p.type == null) {\r\n      //                 delete p.type\r\n      //                 delete p.src.type\r\n      //                 delete p.target.type\r\n      //               }  \r\n      //             })\r\n      //           }  \r\n\r\n      //         })\r\n      //         return result;\r\n      //       },\r\n\t\t\t\r\n\t\t\tcreateTimeline: function(){\r\n\t\t\tvar thos = this;\t\r\n\t\t\t  dialog({\r\n\t\t        title:\"Select Timeline Excel file\",\r\n\t\t        fields:{\r\n\t\t          file:{\r\n\t\t            title:\"Timeline file:\", \r\n\t\t            type:'file', \r\n\t\t            editable:true, \r\n\t\t            required:true\r\n\t\t          }\r\n\t\t        }\r\n\t\t      })\r\n\t\t      \t.then((form) =>{\r\n\r\n\t\t\t        const fd = new FormData();\r\n\t\t\t        // Take the first selected file\r\n\t\t\t        fd.append('file', form.fields.file.value);\r\n\t\t\t        $http.post($dps.getUrl()+appUrls.createTimeline, fd, {\r\n\t\t\t\t          withCredentials: true,\r\n\t\t\t\t          headers: {'Content-Type': undefined},\r\n\t\t\t\t          transformRequest: angular.identity\r\n\t\t\t\t        })\r\n\t\t\t\t        .success(resp => {\r\n\t\t\t\t          \tthos.data = resp.value;\r\n\t\t\t\t          \tthos.conf.dataID = resp.id;\r\n\t\t\t\t          \tthos.conf.serieDataId = resp.id;\r\n\t\t\t\t          \tthos.updateData = true;\r\n\t\t\t\t          \tthos.loadData();\r\n\t\t\t\t        })\r\n\t\t\t\t        .error((data, status) => {\r\n\t\t\t\t          \tif (status === 415) {\r\n\t\t\t\t            \talert.error($translate.instant('WIDGET.V2.APP-LIST.CANNOT_PARSE_DATA_AS_VALID_JSON', {data}));\r\n\t\t\t\t          \t} else {\r\n\t\t\t\t            \talert.error($translate.instant('WIDGET.V2.APP-LIST.ERROR_IMPORTING_APP', {status}));\r\n\t\t\t\t          \t}\r\n\t\t\t\t        });\r\n\t\t\t\t})        \r\n\t\t    },\r\n\r\n\t\t\t\r\n\t\t\tloadOptions : function(){\r\n\t\t\t\treturn $http.get(this.conf.optionsUrl)\r\n\t\t\t},\r\n\r\n\t\t\tloadSeries : function(){\r\n\t\t\t\t// console.log('load series')\r\n\t\t\t\tif(this.conf.serieDataId)\r\n\t\t\t\t\treturn $dps.get(\"/api/data/process/\"+this.conf.serieDataId)\r\n\r\n\t\t\t\tif(this.conf.script)\r\n                    return $dps.post(\"/api/script\",{\r\n                                \"script\": this.conf.script,\r\n                                \"locale\": i18n.locale()\r\n                            })\r\n                            .then((resp) => {\r\n                            \tif (resp.data.type == \"error\") {\r\n                                $error(resp.data.data)\r\n                                return\r\n                            };\r\n                                return {data:resp}\r\n                            })\r\n                            \t          \r\n                // console.log(\"sample\")            \r\n\t\t\t\treturn $http.get(\"/widgets/v2.nvd3-timeline/sample.json\")   \r\n\t\t\t}, \r\n\r\n\t\t\t\r\n\t\t   loadData: function(){\r\n\t\t   \t\t// console.log(\"load data for\", this.wizard.conf.instanceName,this.conf.serieDataId)\r\n\t\t\t\tlet thos = this;\r\n\t\t\t\t$q\r\n\t\t\t\t\t.all([\r\n\t\t\t\t\t\tthos.loadOptions().then((resp) =>{\r\n\t\t\t\t\t\t\tthos.options = resp.data;\r\n\t\t\t\t\t\t\tif(!thos.conf.decoration){\r\n\t\t\t            \t\tthos.conf.decoration = chartAdapter.getDecoration(thos.options);\r\n\t\t\t            \t}\r\n\t\t\t            \tthos.conf.decoration.setColor = (palette) => {thos.conf.decoration.color = angular.copy(palette) }\r\n\t\t\t            \t// console.log(\"thos.options\",thos.options)\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tthos.loadSeries().then((resp) => {\r\n\t\t\t\t\t\t\t// console.log(\"DECORATION LOAD DATA\",resp.data.value)\r\n\t\t\t\t\t\t\tthos.metadata = resp.data.value.metadata; \r\n\t\t\t\t\t\t\tthos.data =resp.data.value.data.series; //thos._prepare( resp.data.value)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthos.scopeStub = {\r\n\t\t\t\t\t\t\t\tdictionary: $lookup.dictionary(resp.data.value.dictionary),\r\n\t\t\t\t\t\t\t\ttranslations: i18n.translation(resp.data.value.dictionary.filter(item => item.type==\"i18n\"))\r\n\t\t\t               }\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// console.log(\"thos.data\",thos.data)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t])\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tif(thos.updateData){\r\n\r\n\t\t\t\t\t\t\tthos.conf.decoration.title = thos.metadata.dataset.label;\r\n\t\t\t\t\t\t\tthos.conf.decoration.subtitle = thos.metadata.dataset.note;\r\n\t\t\t\t\t\t\tthos.updateData = false;\r\n\t\t\t\t\t\t\t//console.log(\"data loaded\", thos)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthos.apply();\r\n\t\t\t\t\t})\r\n\r\n\t\t\t},\r\n\r\n\t\t\tactivate : function(wizard){\r\n\t\t\t\t// if (this.conf.dataID){\r\n\t\t\t\t\tthis.loadData();\r\n\t\t\t\t// }\r\n\t\t\t},\r\n\r\n\t\t\teditScript: function() {\r\n                var thos = this;\r\n                dpsEditor(thos.conf.script)\r\n                    .then((script) => {\r\n                        thos.conf.script = script;\r\n                        thos.loadData();\r\n                    })\r\n            },\r\n\r\n\t\t\tapply: function(){\r\n\t\t\t\tthis.conf.decoration.width = parentHolder(this.wizard.conf).width;\r\n\t\t\t\tchartAdapter.applyDecoration(this.options,this.conf.decoration,undefined,undefined,this.scopeStub);\r\n\t\t\t\tthis.settings = {options:angular.copy(this.options), data:angular.copy(this.data)};\r\n\t\t\t\t// console.log(\"this.settings\",this.settings)\r\n\t\t\t\t\r\n\t\t\t}\t\r\n\t    }\r\n}]);    \t\r\n\r\n"],"sourceRoot":"/source/"}