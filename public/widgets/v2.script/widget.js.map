{"version":3,"sources":["v2.script/widget.js"],"names":[],"mappings":"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","file":"v2.script/widget.js","sourcesContent":["import angular from 'angular';\r\n// import 'dictionary';\r\n// import 'ngReact';\r\n// import 'custom-react-directives';\r\n// import 'ng-prettyjson';\r\nimport 'ng-ace';\r\n\r\n\r\nlet m = angular.module('app.widgets.v2.script', [\r\n    // 'app.dictionary',\r\n    'app.dps',\r\n    // 'ngFileUpload',\r\n    // 'react',\r\n    // 'custom-react-directives',\r\n    // 'ngPrettyJson',\r\n    \"ng.ace\"\r\n])\r\n\r\n\r\nm.controller('ScriptController', function($scope, $http, $dps, EventEmitter,\r\n    APIProvider, pageSubscriptions, $lookup, $translate, $modal,\r\n    user, i18n, $scroll, clipboard, dialog, $error, log) {\r\n\r\n    const eventEmitter = new EventEmitter($scope);\r\n    \r\n    var __script;\r\n    \r\n    $scope.options = {\r\n        mode:'dps', \r\n        theme:'tomorrow',\r\n        onChange: function(e){\r\n         __script = e[1].getSession().getValue();\r\n        }\r\n    }\r\n\r\n    $scope.getEditorScript = function(){\r\n        return __script;\r\n    }    \r\n\r\n    $scope.examples = [{\r\n            title: \"DJ DPS version\",\r\n            url: \"./widgets/v2.script/scripts/version.dps\"\r\n        }, {\r\n            title: \"DJ DPS help\",\r\n            url: \"./widgets/v2.script/scripts/help.dps\"\r\n        }, {\r\n            title: \"Working with metadata\",\r\n            url: \"./widgets/v2.script/scripts/metadata.dps\"\r\n        }, {\r\n            title: \"Find data\",\r\n            url: \"./widgets/v2.script/scripts/find_datasets.dps\"\r\n        }, {\r\n            title: \"Extend and translate\",\r\n            url: \"./widgets/v2.script/scripts/translate.dps\"\r\n        }, {\r\n            title: \"Get info from metadata\",\r\n            url: \"./widgets/v2.script/scripts/custom-info.dps\"\r\n        }, {\r\n            title: \"Data Cube Projection\",\r\n            url: \"./widgets/v2.script/scripts/projection.dps\"\r\n        }, {\r\n            title: \"Table Postprocessing\",\r\n            url: \"./widgets/v2.script/scripts/postprocess.dps\"\r\n        }, {\r\n            title: \"Table Analitics\",\r\n            url: \"./widgets/v2.script/scripts/analitics.dps\"\r\n        }, {\r\n            title: \"Data Normalization\",\r\n            url: \"./widgets/v2.script/scripts/normalization.dps\"\r\n        }, {\r\n            title: \"Join tables\",\r\n            url: \"./widgets/v2.script/scripts/join.dps\"\r\n        }, {\r\n            title: \"Correlation matrix\",\r\n            url: \"./widgets/v2.script/scripts/corr.dps\"\r\n        }, {\r\n            title: \"Clusters\",\r\n            url: \"./widgets/v2.script/scripts/clusters.dps\"\r\n        }, {\r\n            title: \"PCA (Scores)\",\r\n            url: \"./widgets/v2.script/scripts/scores.dps\"\r\n        }, {\r\n            title: \"PCA (Eigen Values)\",\r\n            url: \"./widgets/v2.script/scripts/ev.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Vertical Bar Chart\",\r\n            url: \"./widgets/v2.script/scripts/bar.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Horizontal Bar Chart\",\r\n            url: \"./widgets/v2.script/scripts/hbar.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Radar Chart\",\r\n            url: \"./widgets/v2.script/scripts/radar.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Line Chart\",\r\n            url: \"./widgets/v2.script/scripts/sample1.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Area Chart\",\r\n            url: \"./widgets/v2.script/scripts/area.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Scatter Chart\",\r\n            url: \"./widgets/v2.script/scripts/scatter.dps\"\r\n        }, {\r\n            title: \"Data Visualization. Dependency Exploration\",\r\n            url: \"./widgets/v2.script/scripts/deps.dps\"\r\n        }, {\r\n            title: \"Export xlsx\",\r\n            url: \"./widgets/v2.script/scripts/export-source.dps\"\r\n        }, {\r\n            title: \"Export csv\",\r\n            url: \"./widgets/v2.script/scripts/export-table.dps\"\r\n        }\r\n\r\n    ]\r\n\r\n\r\n    $scope.getScript = function(s) {\r\n        var e = $scope.examples.filter(item => item.title == s)[0]\r\n        if (e) {\r\n            if (e.script) {\r\n                $scope.script = e.script\r\n                $scope.settings = {\r\n                    options: $scope.options,\r\n                    data: $scope.script\r\n                }\r\n            } else {\r\n                $http\r\n                    .get(e.url)\r\n                    .then(function(resp) {\r\n                        e.script = resp.data;\r\n                        $scope.script = e.script\r\n                        $scope.settings = {\r\n                            options: $scope.options,\r\n                            data: $scope.script\r\n                        }\r\n                    })\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    $scope.selectedExample;\r\n\r\n    $scope.$watch('selectedExample', (newValue, oldValue) => {\r\n        // if (newValue !== oldValue) {\r\n            $scope.getScript(newValue)\r\n        // }\r\n    });\r\n\r\n        \r\n    \r\n\r\n    \r\n    $scope.runScript = function() {\r\n        $scope.response = undefined;\r\n        eventEmitter.emit('setData', undefined);\r\n        \r\n        var s = ($scope.widget.editor) \r\n                    ? $scope.getEditorScript()\r\n                    : $scope.script;\r\n        \r\n        $dps.post(\"/api/script\", {\r\n                \"script\": s,\r\n                \"key\": $scope.key,\r\n                \"locale\": i18n.locale()\r\n            })\r\n            .then(function(response) {\r\n                response.data.key = response.data.type;\r\n                if (response.data.key == 'error') {\r\n                    $error(response.data.data)\r\n                    $scope.response = {\r\n                        key: \"error\",\r\n                        data: response.data.data\r\n                    }\r\n                    eventEmitter.emit('setData', $scope.response);\r\n                } else {\r\n                    if (response.data.key == \"url\") {\r\n                        $scope.response = {\r\n                            data: {\r\n                                success: $dps.getUrl() + response.data.data.url\r\n                            },\r\n                            key: \"json\"\r\n                        }\r\n                        window.open($dps.getUrl() + response.data.data.url, '_blank')\r\n                    } else {\r\n                        if(response.data.key == \"log\"){\r\n                            log({ title: \"\", messages: response.data.data});\r\n                            $scope.response = response.data \r\n                        }else{\r\n                            $scope.response = response.data    \r\n                        }\r\n                    }\r\n                    eventEmitter.emit('setData', $scope.response);\r\n                }\r\n            })\r\n    }\r\n    \r\n    \r\n    new APIProvider($scope)\r\n        .config(() => {\r\n            \r\n            $scope.script = $scope.widget.script\r\n            \r\n\r\n\r\n            if (($scope.widget.examples)) {\r\n                $scope.selectedExample = $scope.examples[0].title;\r\n                $scope.getScript($scope.selectedExample)\r\n            }\r\n\r\n            $scope.examplesEnable = $scope.widget.examples;\r\n\r\n            $scope.settings = {\r\n                options: $scope.options,\r\n                data: $scope.script\r\n            }\r\n\r\n            $scope.d_listeners = ($scope.widget.d_listeners) ? $scope.widget.d_listeners.split(\",\") : [];\r\n            pageSubscriptions().removeListeners({\r\n                emitter: $scope.widget.instanceName,\r\n                signal: \"setData\"\r\n            })\r\n\r\n            $scope.response = {\r\n                message: \"Write script and execute it\"\r\n            };\r\n\r\n            pageSubscriptions().addListeners(\r\n                $scope.d_listeners.map((item) => {\r\n                    return {\r\n                        emitter: $scope.widget.instanceName,\r\n                        receiver: item.trim(),\r\n                        signal: \"setData\",\r\n                        slot: \"setData\"\r\n                    }\r\n                })\r\n            );\r\n\r\n            eventEmitter.emit('setData', undefined);\r\n        })\r\n\r\n    .openCustomSettings(function() {\r\n        return dialog({\r\n                title: \"DJ DP Script settings\",\r\n                fields: {\r\n                    title: {\r\n                        title: \"Title\",\r\n                        type: \"text\",\r\n                        value: $scope.widget.title,\r\n                        required: false\r\n                    },\r\n                    examples: {\r\n                        title: \"Enable Examples\",\r\n                        type: \"checkbox\",\r\n                        value: $scope.widget.examples\r\n                    },\r\n                    editor: {\r\n                        title: \"Enable Editor\",\r\n                        type: \"checkbox\",\r\n                        value: $scope.widget.editor\r\n                    },\r\n                    runnable: {\r\n                        title: \"Enable Run\",\r\n                        type: \"checkbox\",\r\n                        value: $scope.widget.runnable\r\n                    },\r\n                    hidden: {\r\n                        title: \"Hidden in presentation mode\",\r\n                        type: \"checkbox\",\r\n                        value: $scope.widget.hidden || false\r\n                    },\r\n                    height: {\r\n                        title: \"Editor height in (em)\",\r\n                        type: \"number\",\r\n                        min: 5,\r\n                        value: $scope.widget.height || 20\r\n                    },\r\n\r\n                    // script: {\r\n                    //     title: \"DP Script\",\r\n                    //     type: \"textarea\",\r\n                    //     value: $scope.script,\r\n                    //     required: false\r\n                    // },\r\n\r\n                    d_listeners: {\r\n                        title: \"Listeners\",\r\n                        type: \"text\",\r\n                        value: $scope.widget.d_listeners,\r\n                        required: false\r\n                    }\r\n                }\r\n            })\r\n            .then(function(form) {\r\n                $scope.widget.title = form.fields.title.value;\r\n                $scope.widget.height = form.fields.height.value;\r\n                $scope.widget.examples = form.fields.examples.value;\r\n                $scope.widget.editor = form.fields.editor.value;\r\n                $scope.widget.d_listeners = form.fields.d_listeners.value;\r\n                $scope.widget.runnable = form.fields.runnable.value;\r\n                $scope.widget.hidden = form.fields.hidden.value;\r\n                $scope.widget.script = $scope.getEditorScript();//$scope.session.getValue();\r\n                //$scope.script = $scope.widget.script; // = form.fields.script.value;\r\n            })\r\n    })\r\n\r\n    .removal(() => {\r\n        console.log('Script widget is destroyed');\r\n    });\r\n})\r\n"],"sourceRoot":"/source/"}