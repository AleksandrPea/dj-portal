{"version":3,"sources":["v2.event-viewer/widget.js"],"names":[],"mappings":"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","file":"v2.event-viewer/widget.js","sourcesContent":["import angular from 'angular';\r\nimport 'angular-foundation';\r\n\r\n\r\nangular\r\n  .module('app.widgets.v2.event-viewer', ['mm.foundation'])\r\n  .controller('EventViewerController', \r\n    function ($scope, pageSubscriptions, APIProvider, i18n, $sce) {\r\n\r\n  $scope.navigate = function(e,d){\r\n\r\n      \r\n      if(!d || !d.data){\r\n        $scope.context = undefined;\r\n      }else{\r\n\r\n       // console.log(d)\r\n\r\n       var timeStamp = (d.data.type == \"instant\")\r\n          ? i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.instant)\r\n          : (d.data.type == \"process\")\r\n            ? (i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.process) === i18n.timeFormat(d.data.originalEnd,$scope.widget.timeFormat.process)) \r\n              ? i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.instant)+\" - \"+i18n.timeFormat(d.data.originalEnd,$scope.widget.timeFormat.instant)\r\n              : i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.process)+\" - \"+i18n.timeFormat(d.data.originalEnd,$scope.widget.timeFormat.process)\r\n            : (i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.flow) === i18n.timeFormat(d.data.originalEnd,$scope.widget.timeFormat.flow))\r\n              ? i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.process)+\" - \"+i18n.timeFormat(d.data.originalEnd,$scope.widget.timeFormat.process)\r\n              : i18n.timeFormat(d.data.originalStart,$scope.widget.timeFormat.flow)+\" - \"+i18n.timeFormat(d.data.originalEnd,$scope.widget.timeFormat.flow)\r\n         \r\n       \r\n        var tmp = d.dict.lookup(angular.copy(d.data.context));\r\n        // console.log(\r\n        //     d.data.category,\r\n        //     d.dict.lookup(d.data.category), \r\n        //     d.tr.translate(d.dict.lookup(angular.copy(d.data.category)))\r\n        // )\r\n        $scope.context = {\r\n          timestamp:timeStamp,\r\n          type : d.data.type,\r\n          category: d.tr.translate(d.dict.lookup(angular.copy(d.data.category)).label),\r\n          context:{\r\n\r\n            color: d.data._color,\r\n            bgColor: d.data._bgColor,\r\n            headline:d.tr.translate(tmp.headline),\r\n            text:d.tr.translate(tmp.text),\r\n            media: d.tr.translate(tmp.media),\r\n            url:(tmp.url)\r\n                ? {\r\n                    href : d.tr.translate(tmp.url.href),\r\n                    label : (tmp.url.label && tmp.url.label !='')\r\n                      ? d.tr.translate(tmp.url.label)\r\n                      : decodeURIComponent(d.tr.translate(tmp.url.href))\r\n                  }\r\n                : undefined,\r\n            html: (tmp.html) ? $sce.trustAsHtml(tmp.html) : $sce.trustAsHtml('')       \r\n          }\r\n        }\r\n      }\r\n  }    \r\n  \r\n  new APIProvider($scope)\r\n    .config(() => {\r\n\r\n      $scope.widget.timeFormat = $scope.widget.timeFormat || {\r\n        flow: \"YYYY\",\r\n        process: \"MM.YYYY\",\r\n        instant: \"DD/MM/YYYY\"\r\n      };\r\n      \r\n        \r\n      if($scope.widget.emitters && $scope.widget.emitters.length &&\r\n        $scope.widget.emitters.trim().length > 0){\r\n          \r\n        pageSubscriptions().removeListeners({\r\n            receiver: $scope.widget.instanceName,\r\n            signal: \"timelineNavigate\"\r\n        });\r\n\r\n        $scope.emitters = ($scope.widget.emitters) ? $scope.widget.emitters.split(\",\") : [];\r\n          \r\n        pageSubscriptions().addListeners(\r\n          $scope.emitters.map((item) =>{\r\n            return {\r\n                emitter: item.trim(),\r\n                receiver: $scope.widget.instanceName,\r\n                signal: \"timelineNavigate\",\r\n                slot: \"timelineNavigate\"\r\n            }\r\n          })\r\n        );\r\n\r\n      }else{\r\n\r\n        pageSubscriptions().removeListeners({\r\n            receiver: $scope.widget.instanceName,\r\n            signal: \"timelineNavigate\"\r\n        });\r\n\r\n      }\r\n\r\n    })\r\n    \r\n    .provide(\"timelineNavigate\", $scope.navigate)\r\n    \r\n    .translate(()=>{\r\n    })\r\n\r\n    .provide('updateWithData', (e, context) => {\r\n            \r\n            if (!context) return\r\n\r\n            if (context.widget) {\r\n                context.widget = (context.widget.forEach) ? context.widget : [context.widget]\r\n            }\r\n\r\n            if (!context.widget || (context.widget.indexOf($scope.widget.instanceName) >= 0)) {\r\n               $scope.navigate(e,context.data)\r\n                if (context.options){\r\n                    $scope.hidden = context.options.hidden;\r\n                }\r\n            }\r\n\r\n\r\n\r\n        })\r\n        .provide('updateWithOptions', (e, context) => {\r\n            \r\n            if (!context) return\r\n\r\n            if (context.widget) {\r\n                context.widget = (context.widget.forEach) ? context.widget : [context.widget]\r\n            }\r\n\r\n            if (!context.widget || (context.widget.indexOf($scope.widget.instanceName) >= 0)) {\r\n                $scope.hidden = context.options.hidden;\r\n            }\r\n        })\r\n\r\n   \r\n    \r\n})"],"sourceRoot":"/source/"}