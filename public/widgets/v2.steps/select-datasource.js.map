{"version":3,"sources":["v2.steps/select-datasource.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,kBAAkB,UAAU,KAAK,EAAE,OAAO,OAAO,IAAI,aAAa,IAAI,aAAa;;AAEvF,IAJO,UAAO,gBAAA,QAAM;;AAEpB,IAAI,IAAI,QAAQ,OAAO,0CAAyC;;AAEhE,EAAE,QAAQ,oBAAmB,CAAC,WAAW,SAAS,UAAS,SAAS,OAAM;EACzE,OAAO;;IAEN,OAAQ;;IAER,aAAc;;IAER,MAAO;;IAGb,eAAe,SAAA,cAAS,QAAO;MAC9B,KAAK,SAAS;MACb,IAAI,QAAQ,OAAO;;MAEnB,IAAI,QAAQ,YAAY,OAAO,KAAK,eAAc;QACjD,OAAO,QAAQ;aACX;QACJ,KAAK,eAAe,OAAO,KAAK;;;MAGjC,IAAI,OAAO;MACZ,MAAM,OAAO,kBAAgB,KAAK,QAAM,WAAW,UAAS,OAAO;QAC5D,MAAM,aAAa;QACnB,IAAI,SAAS,MAAM;UAChB,KAAK,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;YACrC,MAAM,WAAW;YACjB,CAAC,UAAS,MAAM;cACb,KAAK,OAAO;eACZ,MAAM;;;;;;IAMhB,sBAAsB,SAAA,uBAAU;MAC/B,IAAI,OAAO;MACX,MAAM,IAAI,2BACT,QAAQ,UAAU,MAAM;QACtB,KAAK,cAAc,KAAK;QACxB,IAAI;QACJ,IAAG,QAAQ,UAAU,KAAK,eAAc;UACvC,aAAa,KAAK,YAAY,OAAO,UAAS,MAAK;YACjD,OAAO,KAAK,MAAM,KAAK;;;;QAI5B,IAAI,cAAc,WAAW,SAAS,GAAE;UACpC,KAAK,iBAAiB,WAAW;;SAGrC,MAAM,UAAU,MAAM,QAAQ;QAC5B,QAAQ,MAAM,iBAAiB,SAAS;;;;IAIlD,QAAQ,SAAA,OAAU,MAAM;MACvB,IAAI,OAAO;;MAEX,KAAK,SAAS,QAAQ,OAAO;QAC5B,KAAK;QACL,QAAQ;QACR,SAAS;UACP,aAAc;;QAEhB,MAAM;;MAGP,KAAK,OAAO,KAAK,UAAS,UAAU;QAClC,SAAS,YAAW;UACpB,KAAK;;SAEJ,UAAS,UAAU;QACrB,IAAI,SAAS,SAAS,GACtB,KAAK,MAAM,WAAW,SAAS,SAAS,OAAO,SAAS;;;MAGzD,KAAK,OAAO,SAAS,UAAS,KAAK;QACnC,KAAK,WAAW,KAAK,IAAI,KAAK,SAAS,MAAQ,IAAI,SAAS,IAAI;QAChE,QAAQ,IAAI;;;MAGZ,KAAK,OAAO,IAAI,UAAS,KAAK;;;IAK/B,QAAQ,SAAA,OAAS,YAAW;MACrB,IAAG,CAAC,KAAK,aAAW;QAAE;OAAO,IACzB,OAAO;MACX,KAAK,YAAY,QAAQ,UAAS,MAAK;QACpC,IAAG,KAAK,MAAM,WAAW,IAAG;UAC1B,KAAK,WAAW;UAChB,KAAK,qBAAqB;UAC1B,KAAK,eAAe,WAAW;UAC/B,KAAK,OAAO,SAAS;eAElB;UACH,KAAK,WAAW;;;;;IAMtB,UAAW,SAAA,SAAS,QAAO;;MAE1B,IAAI,CAAC,KAAK,aAAc;QACvB,KAAK;;;;IAIX","file":"v2.steps/select-datasource.js","sourcesContent":["import angular from 'angular';\r\n\r\nvar m = angular.module(\"app.widgets.v2.steps.select-datasource\",[]);\r\n\r\nm.factory(\"SelectDatasource\",[\"$upload\", '$http', function($upload, $http){\r\n\treturn {\r\n\t\t\r\n\t\ttitle : \"Datasource\",\r\n\t\t\r\n\t\tdescription : \"Select or upload datasource\",\r\n        \r\n        html : \"./widgets/v2.steps/select-datasource.html\",\r\n\r\n\r\n\t\tonStartWizard: function(wizard){\r\n\t\t\tthis.wizard = wizard;\r\n\t\t \tvar scope = wizard.parentScope;\r\n\t\t \t\r\n\t\t \tif( angular.isUndefined(wizard.conf.datasourceID)){\r\n\t\t \t\twizard.process(this);\r\n\t\t \t}else{\r\n\t\t \t\tthis.datasourceID = wizard.conf.datasourceID; \r\n\t\t \t}\r\n\r\n\t\t \tvar thos = this;     \t\r\n\t\t\tscope.$watch('wizard.steps['+thos.index+'].files', function(files) {\r\n        \t\tscope.formUpload = false;\r\n        \t\tif (files != null) {\r\n          \t\t\tfor (var i = 0; i < files.length; i++) {\r\n            \t\t\tscope.errorMsg = null;\r\n            \t\t\t(function(file) {\r\n              \t\t\t\tthos.upload(file);\r\n            \t\t\t})(files[i]);\r\n          \t\t\t}\r\n        \t\t}\r\n      \t\t});\r\n        },\r\n\r\n        updateDatasourceList: function(){\r\n        \tvar thos = this;\r\n        \t$http.get(\"./api/data/dataSources/\")\r\n        \t.success(function (data) {\r\n          \t\tthos.dataSources = data.reverse();\r\n          \t\tvar selectedDS;\r\n          \t\tif(angular.isDefined(thos.datasourceID)){\r\n          \t\t\tselectedDS = thos.datasources.filter(function(item){\r\n            \t\t\treturn item.id == thos.datasourceID;\r\n          \t\t\t});\t\r\n          \t\t}\r\n          \t\t\r\n\t\t        if (selectedDS && selectedDS.length > 0){\r\n\t\t            thos.selectDataSource(selectedDS[0])\r\n\t\t        }  \r\n        \t})\r\n        \t.error(function (data, status) {\r\n          \t\t$window.alert(\"$http error \" + status + \" - cannot load data\");\r\n        \t});\r\n      \t},\r\n\r\n\t\tupload: function (file) {\r\n\t\t\tvar thos = this;\r\n\r\n\t\t\tfile.upload = $upload.upload({\r\n\t\t\t\turl: './api/data/dataSource',\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: {\r\n\t\t\t\t  'my-header' : 'my-header-value'\r\n\t\t\t\t},\r\n\t\t\t\tfile: file,\r\n\t\t\t});\r\n\r\n\t\t\tfile.upload.then(function(response) {\r\n\t\t\t\t\t$timeout(function() {\r\n\t\t\t\t\tthos.updateDatasourceList();\r\n\t\t\t\t});\r\n\t\t\t}, function(response) {\r\n\t\t\t\tif (response.status > 0)\r\n\t\t\t\tthos.scope.errorMsg = response.status + ': ' + response.data;\r\n\t\t\t});\r\n\r\n\t\t\tfile.upload.progress(function(evt) {\r\n\t\t\tfile.progress = Math.min(100, parseInt(100.0 * evt.loaded / evt.total));\r\n\t\t\tconsole.log(file)\r\n\t\t\t});\r\n\r\n\t\t\tfile.upload.xhr(function(xhr) {\r\n\t\t\t});\r\n\t\t},\r\n\r\n\r\n\t\tselect: function(datasource){\r\n        \tif(!this.dataSources) return;\r\n        \tvar thos = this;\r\n        \tthis.dataSources.forEach(function(item){\r\n          \t\tif(item.id == datasource.id){\r\n            \t\titem.selected = true;\r\n            \t\tthos.selectedDataSource = datasource;\r\n            \t\tthos.datasourceID = datasource.id;\r\n            \t\tthis.wizard.complete(this);\r\n            \t\t\r\n          \t\t}else{\r\n            \t\titem.selected = false;\r\n          \t\t}\r\n        \t})\r\n      \t},\r\n\r\n\r\n        activate : function(wizard){\r\n        \t\r\n        \tif( !this.dataSources ) {\r\n        \t\tthis.updateDatasourceList;\r\n        \t}\t\r\n        }\t\r\n\t}\r\n}]);\t"],"sourceRoot":"/source/"}