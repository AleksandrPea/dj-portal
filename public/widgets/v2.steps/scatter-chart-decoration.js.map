{"version":3,"sources":["v2.steps/scatter-chart-decoration.js"],"names":[],"mappings":"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","file":"v2.steps/scatter-chart-decoration.js","sourcesContent":["import angular from 'angular';\r\nimport 'widgets/v2.nvd3-widget/nvd3-widget';\r\nimport \"widgets/v2.nvd3-scatter/adapter\";\r\nimport \"wizard-directives\";\r\n\r\n\r\nvar m = angular.module(\"app.widgets.v2.steps.scatter-chart-decoration\",[\r\n\t'app.widgets.v2.nvd3-widget',\r\n    \"app.widgets.v2.scatter-chart-adapter\", \r\n    \"wizard-directives\"]);\r\n\r\nm.factory(\"ScatterChartDecoration\",[\r\n\t\"$http\",\r\n\t\"$q\", \r\n\t\"parentHolder\",\r\n\t\"NVD3ScatterAdapter\",\r\n\t\"pageWidgets\", \r\n\tfunction(\r\n\t\t$http, \r\n\t\t$q, \r\n\t\tparentHolder, \r\n\t\tNVD3ScatterAdapter,\r\n\t\tpageWidgets ){\r\n\t\t\r\n\t\tlet chartAdapter = NVD3ScatterAdapter;\r\n\r\n\t\treturn {\r\n\t\t\tid: \"ScatterChartDecoration\",\r\n\r\n\t\t\ttitle : \"Chart Decoration\",\r\n\t\t\t\r\n\t\t\tdescription : \"Setup chart decoration options\",\r\n\t        \r\n\t    \thtml : \"./widgets/v2.steps/scatter-chart-decoration.html\",\r\n\r\n\t    \tonStartWizard: function(wizard){\r\n\t    \t\tthis.wizard = wizard;\r\n\t    \t\tthis.conf = {\r\n\t    \t\t\taxisX : (wizard.conf.axisX) ? wizard.conf.axisX : -1,\r\n\t    \t\t\tdecoration : wizard.conf.decoration,\r\n\t    \t\t\tdataID : wizard.conf.dataID,\r\n\t    \t\t\tqueryID : wizard.conf.queryID,\r\n\t    \t\t\tserieDataId : wizard.conf.serieDataId,\r\n\t    \t\t\toptionsUrl : \"./widgets/v2.nvd3-scatter/options.json\",\r\n\t    \t\t\tdataUrl : \"./api/data/process/\"\r\n\t    \t\t}\t\r\n\r\n\t    \t\tthis.queries = [];\r\n\r\n\t    \t\tpageWidgets()\r\n\t    \t\t\t.filter((item) => item.type ==\"v2.query-manager\")\r\n\t    \t\t\t.map((item) => item.queries)\r\n\t    \t\t\t.forEach((item) => {this.queries = this.queries.concat(item)})\r\n\r\n\t    \t\tif(this.conf.queryID){\r\n\t    \t\t\tlet thos = this;\r\n\t    \t\t\tthis.inputQuery = this.queries.filter((item) => item.$id == this.conf.queryID)[0].$title;\r\n\t    \t\t}\t\t\r\n\r\n\t    \t},\r\n\r\n\t    \tonFinishWizard:  function(wizard){\r\n\r\n\t    \t\tthis.conf.decoration.setColor = undefined;\r\n\t    \t\twizard.conf.decoration = this.conf.decoration;\r\n\t    \t\twizard.conf.serieDataId  = this.conf.serieDataId; \r\n\t    \t\twizard.conf.queryID  = this.conf.queryID;\r\n\t    \t\twizard.conf.dataID  = this.conf.dataID;\r\n\t    \t\twizard.conf.axisX = this.conf.axisX; \r\n\t\t\t\t\r\n\t    \t\tthis.settings = {options:angular.copy(this.options), data:[]};\r\n\t    \t\tthis.conf = {};\r\n\r\n\t    \t},\r\n\r\n\t    \tonCancelWizard: function(wizard){\r\n\t\t\t\tthis.settings = {options:angular.copy(this.options), data:[]};\r\n\t\t\t\tthis.conf = {};\r\n\t    \t},\r\n\r\n\t    \treversePalette: function(){\r\n\t\t\t\tif ( this.conf.decoration.color ){\r\n\t\t\t\t\tthis.conf.decoration.color = this.conf.decoration.color.reverse(); \r\n\t\t\t\t}\t\r\n\t\t\t},\r\n\r\n\t\t\tselectInputData: function(){\r\n\t\t\t\tlet thos = this;\r\n\t\t\t\tthos.wizard.context.postprocessedTable = undefined;\r\n      \t\t\tlet iq = this.queries.filter((item) => item.$title == thos.inputQuery)[0];\r\n\t\t\t\tthis.conf.dataID = iq.context.queryResultId;\r\n\t\t\t\tthis.conf.queryID = iq.$id;\r\n\t\t\t\tthis.loadData();\r\n\t\t\t},\r\n\r\n\r\n\t\t\tloadOptions : function(){\r\n\t\t\t\treturn $http.get(this.conf.optionsUrl)\r\n\t\t\t},\r\n\r\n\t\t\tloadSeries : function(){\r\n\t\t\t\tlet r = $http.post(this.conf.dataUrl,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"cache\": false,\r\n\t\t                \"data_id\": this.conf.dataID,\r\n\t\t                \"params\": {\"axisX\":this.conf.axisX},\r\n\t\t                \"proc_name\": \"scatter-serie\",\r\n\t\t                \"response_type\": \"data\"\r\n\t\t            }\r\n\t\t\t\t)\r\n\t\t\t\treturn r\r\n\t\t\t},\r\n\r\n\t\t\tmakeAxisXList : function(table){\r\n\t\t\t    var result = [];\r\n\t\t\t    table.body[0].metadata.forEach(function(item,index){\r\n\t\t\t        result.push({\r\n\t\t\t        index : -index-1,\r\n\t\t\t        label : item.dimensionLabel \r\n\t\t\t        })\r\n\t\t\t    });\r\n\t\t\t    if (table.header.length >1){\r\n\t\t\t      \ttable.header.forEach(function(column,index){\r\n\t\t\t        \tvar label = \"\";\r\n\t\t\t        \tcolumn.metadata.forEach(function(item){\r\n\t\t\t          \tlabel = (label == \"\") ? item.label : label+\", \"+item.label;\r\n\t\t\t        \t})\r\n\t\t\t        \tresult.push({\r\n\t\t\t          \t\tindex : index,\r\n\t\t\t          \t\tlabel : label\r\n\t\t\t        \t})\r\n\t\t\t      \t});\r\n\t\t  \t\t}\r\n\t\t      let thos = this;\r\n\t\t      this.axisXColumn = result.filter((item) => item.index == thos.conf.axisX)[0].label;\r\n\t\t      \r\n\t\t      return result;\r\n\t\t    },\r\n\r\n\t\t    selectAxisX : function(){\r\n\t\t      var thos = this;\r\n\t\t      this.conf.axisX = this.axisXList.filter((item) => item.label == thos.axisXColumn)[0].index;\r\n\t\t      \r\n\t\t      // console.log(this.conf)\r\n\r\n\t\t    },\r\n\r\n\r\n\t\t    loadData: function(){\r\n\t\t\t\tlet thos = this;\r\n\r\n\t\t\t\tif(!this.wizard.context.postprocessedTable){\r\n\t\t\t\t\t$http\r\n\t\t\t          .get(\"./api/data/process/\"+this.conf.dataID)\r\n\t\t\t          .success(function (resp) {\r\n\t\t\t              thos.wizard.context.postprocessedTable = resp.value;\r\n\t\t\t               thos.axisXList = thos.makeAxisXList(thos.wizard.context.postprocessedTable);\r\n\t\t\t          })\r\n\t\t\t\t}else{\r\n\t\t\t\t\t this.axisXList = this.makeAxisXList(this.wizard.context.postprocessedTable);\r\n\t\t\t   }\r\n\r\n\t\t\t\t\r\n\t\t\t\tthis.optionsLoaded = //(this.optionsLoaded) ? this.optionsLoaded :\r\n\t\t\t\t\tthis.loadOptions().then( (options) => {\r\n\t\t\t\t\t\tthos.options = options.data;\r\n\t                \tif(!thos.conf.decoration){\r\n\t\t\t            \tthos.conf.decoration = chartAdapter.getDecoration(thos.options);\r\n\t\t\t            }\r\n\t\t            \r\n\t\t\t            thos.conf.decoration.setColor = (palette) => {thos.conf.decoration.color = angular.copy(palette) }\r\n\t\t\t            thos.options.chart.x = (d) => d.x;\r\n\t\t                thos.options.chart.y = (d) => d.y;\r\n\t\t                 thos.options.tooltipContent= function (serie, x, y, s) {\r\n                //console.thos.options.log(serie,x,y,s)\r\n                return \"<b><center>\" + s.point.label + \"</center></b>\"\r\n                  + '<div style=\"font-size:smaller;padding: 0 0.5em;\"> ' + s.series.base + \": \" + x + \"</div>\"\r\n                  + '<div style=\"font-size:smaller;padding: 0 0.5em;\"> ' + serie + \": \" + y + \"</div>\";\r\n              };\r\n\r\n              thos.options.tooltipXContent =  function (serie, x, y, s) {\r\n                //console.log(\"X\",serie,x,y,s)\r\n                return \"<b>\" + s.series.base + \": </b>\" + x\r\n              };\r\n              thos.options.tooltipYContent= function (serie, x, y, s) {\r\n                //console.log(\"X\",serie,x,y,s)\r\n                return \"<b>\" + serie + \": </b>\" + y\r\n              };\r\n\t\t                \r\n\t\t                thos.conf.decoration.width = parentHolder(thos.wizard.conf).width;\r\n\t\t                \r\n\r\n\t\t    //             thos.conf.decoration.title = thos.dataset.dataset.label;\r\n\t\t\t\t\t\t// thos.conf.decoration.subtitle = thos.dataset.dataset.source;\r\n\t\t\t\t\t\t// thos.conf.decoration.caption = 'Note:'+ thos.dataset.dataset.note;\r\n\t\t\t\t\t\t// thos.conf.decoration.xAxisName = thos.dataset.dataset.label;\r\n\t\t\t\t\t\t// thos.conf.decoration.yAxisName = thos.dataset.dataset.label;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\tthis.dataLoaded = //(this.dataLoaded) ? this.dataLoaded :\r\n\t\t\t\t \tthis.loadSeries().then( (resp) => {\r\n\t\t\t\t \t\tthos.data = resp.data.data;\r\n\t\t                thos.conf.serieDataId = resp.data.data_id;\r\n\r\n\t\t            });\r\n\r\n\t\t\t\t$q.all([this.optionsLoaded, this.dataLoaded]).then(() => {\r\n\t\t\t\t\t// thos.apply()\r\n\t\t\t\t\tthos.conf.decoration.width = parentHolder(thos.wizard.conf).width;\r\n\t\t\t\t\tchartAdapter.applyDecoration(thos.options,thos.conf.decoration);\r\n\t\t\t\t\tthos.settings = {options:angular.copy(thos.options), data:angular.copy(thos.data)};\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tactivate : function(wizard){\r\n\t\t\t\tif (this.conf.dataID){\r\n\t\t\t\t\tthis.loadData();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tapply: function(){\r\n\t\t\t\tthis.activate(this.wizard)\r\n\t\t\t}\t\r\n\t    }\r\n}]);    \t\r\n\r\n\r\n"],"sourceRoot":"/source/"}